<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>빌리슈 로그인</title>
  </head>
  <style>
    #cancel a {
      text-decoration: none;
      color: #000;
    }
  </style>
  <body>
    <form name="signInForm">
      <h1>로그인</h1>
      <p>
        <label class="formInput">아이디&nbsp;</label>
        <input type="text" name="id" pattern="^[a-z0-9]{4,16}$" required />
      </p>
      <p>
        <label class="formInput">비밀번호&nbsp;</label>
        <input
          type="password"
          name="pw"
          pattern="^[A-Za-z0-9~?!@#$%^&*_-]{8,16}"
          required
        />
      </p>
    </form>
    <button id="signInButton">로그인</button>
    <button id="cancel">
      <a href="../project/index.html">취소</a>
    </button>
    <h3>ID, 비밀번호를 분실하셨을 경우 관리자에게 문의하여 주시기 바랍니다.</h3>
  </body>
  <script type="module">
    import {
      app,
      // db,
      dbService,
      storageService,
      addDatas,
      getDatas,
      updateDatas,
      deleteDatas,
    } from "../firebase.js";
    import {
      collection,
      query,
      where,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

    async function signInWithIdAndPassword(id, pw){
        try{
            // 사용자의 아이디를 기준으로 Firestore에서 사용자를 검색합니다.
            const usersRef = collection(dbService, "users");
            const querySnapshot = await getDocs(query(usersRef, where('id', '==', id)));

            // id가 공백인 경우 사용자를 찾을 수 없습니다.
            if (querySnapshot.empty){
                throw new Error('사용자를 찾을 수 없습니다.');
            }

            // 사용자를 찾으면 해당 사용자의 데이터를 가져옵니다.
            const userDoc = querySnapshot.docs[0];
            const userData = userDoc.data();

            // 비밀번호를 검증합니다.

            // 인증 성공
            console.log("로그인 성공: ", userData);
            alert("로그인 성공!");
            // 인증 실패
        } catch(error){
            console.error("로그인 실패: ", error.message);
            alert("로그인 실패: "+e)
        }
    }
  </script>
</html>
