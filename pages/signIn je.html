<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>빌리슈 로그인</title>
    <link rel="stylesheet" href="../resources/css/signln je.css" />
  </head>
  <style>
    #cancel a {
      text-decoration: none;
      color: #000;
    }
  </style>
  <body>
    <div class="log">
      <form id="signInForm" name="signInForm">
        <h1>로그인</h1>
        <p>
          <label class="formInput">아이디&nbsp;</label>
          <input type="text" name="id" id="id" required />
        </p>
        <p>
          <label class="formInput">비밀번호&nbsp;</label>
          <input type="password" name="pw" id="pw" required />
        </p>
      </form>
      <div class="bnt">
        <button id="signInButton">로그인</button>
        <button id="cancel">
          <a href="../index.html">취소</a>
        </button>
      </div>
    </div>
    <h3>ID, 비밀번호를 분실하셨을 경우 관리자에게 문의하여 주시기 바랍니다.</h3>
  </body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs,
    } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

    // Firebase를 구성하는 정보
    const firebaseConfig = {
      apiKey: "AIzaSyAacCYNcsw241GRaLn9A5jUuS0hm0qbxbs",
      authDomain: "project-52d4c.firebaseapp.com",
      projectId: "project-52d4c",
      storageBucket: "project-52d4c.appspot.com",
      messagingSenderId: "587892298418",
      appId: "1:587892298418:web:43d4e281e654f11750efab",
      measurementId: "G-ZY1J3CGR0E",
    };

    // Firebase를 초기화합니다.
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const signInButton = document.getElementById("signInButton");

    signInButton.addEventListener("click", async (event) => {
      event.preventDefault();

      const id = document.getElementById("id").value;
      const pw = document.getElementById("pw").value;

      // Firestore에서 사용자의 정보를 검색합니다.
      const usersRef = collection(db, "userInfo");
      const q = query(usersRef, where("id", "==", id));

      try {
        const querySnapshot = await getDocs(q);

        if (!querySnapshot.empty) {
          // Firestore에서 찾은 사용자 정보
          const userInfo = querySnapshot.docs[0].data();
          console.log(userInfo);
          // 비밀번호를 비교합니다.
          if (userInfo.pw === pw) {
            alert(`${userInfo.name}님이 로그인 하셨습니다!`);
            sessionStorage.setItem("userInfo", JSON.stringify(userInfo));
            window.location.href = "../index.html";
          } else {
            alert("아이디 또는 비밀번호가 잘못되었거나 공백입니다.");
          }
        } else {
          alert("아이디 또는 비밀번호가 잘못되었거나 공백입니다.");
        }
      } catch (error) {
        console.error("Error getting documents: ", error);
      }
    });
  </script>
</html>
